package com.zongteng.ztetl.etl.dw.fact.full.transfer

import com.zongteng.ztetl.common.{Dw_fact_common, Dw_par_val_list_cache, SystemCodeUtil}
import com.zongteng.ztetl.util.DateUtil

object DW_fact_tcms_business_full {

    //任务名称(一般同类名)
    private val task = "DW_fact_tcms_business_full"

    //dw层类名
    private val tableName = "fact_tcms_business"

    // 获取当天的时间
    private val nowDate: String = DateUtil.getNowTime()

    //要执行的sql语句
    private val create_fact_tcms_business =
        "select\n\tbb.row_wid,\n\tcast(from_unixtime( unix_timestamp( current_date ( ) ), 'yyyyMMdd' ) AS string )  as etl_proc_wid,\n\tcurrent_timestamp ( ) as w_insert_dt,\n\tcurrent_timestamp ( ) as w_update_dt,\n\tbb.datasource_num_id as datasource_num_id,\n\tbb.data_flag as data_flag,\n\tintegration_id as integration_id,\n\tbb.created_on_dt as created_on_dt,\n\tbb.changed_on_dt as changed_on_dt,\n\tnull AS timezone ,\n\tnull AS exchange_rate,\n\tCONCAT(bb.datasource_num_id, bb.customer_id)  as customer_key,\n\tCONCAT(bb.datasource_num_id, bb.destination_cityid)  as country_key,\n\tbb.tms_id,\n\tbb.bs_id,\n\tbb.arrivalbatch_id,\n\tbb.checkin_og_id,\n\tbb.datasource_code,\n\tbb.transferstatus_code,\n\tbb.returnstatus_code,\n\tbb.operation_status,\n\tbb.documentarystatus_code,\n\tbb.customer_id,\n\tbb.customer_channelid,\n\tbb.arrival_date,\n\tbb.product_code,\n\tbb.checkin_cargotype,\n\tbb.paymentmode_code,\n\tbb.destination_countrycode,\n\tbb.destination_cityid,\n\tbb.destination_postcode,\n\tbb.shipper_weight,\n\tbb.checkin_grossweight,\n\tbb.checkin_volumeweight,\n\tbb.shipper_chargeweight,\n\tbb.estimate_chargeweight,\n\tbb.server_chargeweight,\n\tbb.shipper_pieces,\n\tbb.server_channelid,\n\tbb.checkout_cargotype,\n\tbb.departure_date,\n\tbb.prealert_date,\n\tbb.return_sign,\n\tbb.lastoperate_og_id,\n\tbb.transaction_id,\n\tbb.warehouse_code,\n\tbb.seller_id,\n\tbb.departbatch_id,\n\tbb.checkout_grossweight,\n\tbb.checkout_volumeweight,\n\tbb.mail_cargo_type,\n\tbb.serve_weight_checksign,\n\tbb.invoice_totalcharge,\n\tbb.manual_shipper_chargeweight,\n\tbb.manual_server_chargeweight,\n\tbb.virtual_business,\n\tbb.unit_code,\n\tbb.return_time,\n\tbb.return_note,\n\tbb.sysn_state,\n\tbb.input_mode,\n\tbb.manual_return_fee_sign,\n\tbb.manual_return_fee_date,\n\tbb.sync_fba,\n\tbb.points_bubble_ratio,\n\tbb.manual_return_fee_Accrued_sign,\n\tbb.return_status_audit_state,\n\tbb.volume_coefficient,\n\tbb.volume_state,\n\tbb.last_update_time,\n\tbb.trackingnumber_main,\n\tbb.boxnumber,\n\tbb.server_change,\n\tbb.zd_id,\n\tbb.zs_id,\n\tbb.organization_id,\n\tbb.packing_id,\n\tbb.address_type,\n\tbb.main_orderid,\n\tnvl(pv11.vl_bi_name,bb.datasource_code),\n\tnvl(pv12.vl_bi_name,bb.paymentmode_code),\n\tnvl(pv13.vl_bi_name,bb.input_mode),\n\tnvl(pv14.vl_bi_name,bb.address_type),\n\tdate_format(bb.created_on_dt,'yyyyMM') as month\nfrom\n\t(select * from ods.gc_tcms_bsn_business where data_flag <> 'delete')bb\nleft join\n\t(select * from dw.par_val_list as pvl where pvl.datasource_num_id='9007' and pvl.vl_type='datasource_code' and pvl.vl_datasource_table='gc_tcms_bsn_business')as pv11\non\t\n\tpv11.vl_value = bb.datasource_code\nleft join\n\t(select * from dw.par_val_list as pvl where pvl.datasource_num_id='9007' and pvl.vl_type='paymentmode_code' and pvl.vl_datasource_table='gc_tcms_bsn_business')as pv12\non\t\n\tpv12.vl_value = bb.paymentmode_code\nleft join\n\t(select * from dw.par_val_list as pvl where pvl.datasource_num_id='9007' and pvl.vl_type='input_mode' and pvl.vl_datasource_table='gc_tcms_bsn_business')as pv13\non\t\n\tpv13.vl_value = bb.input_mode\nleft join\n\t(select * from dw.par_val_list as pvl where pvl.datasource_num_id='9007' and pvl.vl_type='address_type' and pvl.vl_datasource_table='gc_tcms_bsn_business')as pv14\non\t\n\tpv14.vl_value = bb.address_type"

    def main(args: Array[String]): Unit = {

        val sqlArray: Array[String] = Array(create_fact_tcms_business).map(_.replaceAll("dw.par_val_list",Dw_par_val_list_cache.TEMP_PAR_VAL_LIST_NAME))
        Dw_fact_common.getRunCode_hive_full_Into(task,tableName,sqlArray,Array(SystemCodeUtil.GC_TCMS))
    }
}
